{% extends 'base.html' %}
{% block title %}Админ — Панель управления{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-xl">

  <!-- Вкладки -->
  <div class="flex gap-4 mb-8">
    <button id="tab-tests"
            class="tab-btn font-semibold px-6 py-2 rounded-2xl bg-blue-100 text-blue-800 hover:bg-blue-200 focus:outline-none transition"
            onclick="showTab('tests')">
      Тесты
    </button>
    <button id="tab-users"
            class="tab-btn font-semibold px-6 py-2 rounded-2xl bg-gray-100 text-gray-800 hover:bg-gray-200 focus:outline-none transition"
            onclick="showTab('users')">
      Пользователи
    </button>
  </div>

  <!-- Вкладка Тесты -->
  <div id="tab-content-tests">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <a href="{{ url_for('tests.list_tests') }}"
         class="bg-gradient-to-tr from-blue-500 to-violet-600 text-white p-8 rounded-2xl shadow hover:shadow-xl hover:-translate-y-1 transition flex flex-col items-center justify-center text-2xl font-bold">
        <svg width="48" height="48" fill="none" viewBox="0 0 24 24" class="mb-3">
          <circle cx="12" cy="12" r="10" fill="white" fill-opacity="0.08"/>
          <path d="M16 8v8M8 8v8M4 12h16" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Управление тестами
        <span class="text-base font-normal mt-2 opacity-80">Посмотреть, создать или редактировать тесты</span>
      </a>
    </div>
  </div>

  <!-- Вкладка Пользователи -->
  <div id="tab-content-users" style="display:none">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-2xl font-bold">Зарегистрированные пользователи</h2>
      <input
        type="text"
        id="user-search"
        placeholder="Поиск по ФИО, логину или таб. номеру..."
        class="border px-4 py-2 rounded-xl shadow focus:outline-none focus:ring-2 focus:ring-blue-400 transition w-72"
        autocomplete="off"
      />
    </div>
    <div class="overflow-x-auto">
      <table class="w-full border rounded-xl shadow-sm bg-white">
        <thead>
          <tr class="bg-gray-100">
            <th class="px-4 py-2 text-left">№</th>
            <th class="px-4 py-2 text-left">ФИО</th>
            <th class="px-4 py-2 text-left">Логин</th>
            <th class="px-4 py-2 text-left">Таб. номер</th>
          </tr>
        </thead>
        <tbody id="users-tbody">
          {% for user in users %}
          <tr>
            <td class="border px-4 py-2">{{ loop.index }}</td>
            <td class="border px-4 py-2">{{ user.fio }}</td>
            <td class="border px-4 py-2">{{ user.username }}</td>
            <td class="border px-4 py-2">{{ user.tab_number or '-' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if not users %}
        <div class="py-8 text-gray-400 text-center text-lg">Нет зарегистрированных пользователей.</div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  // Вкладки
  function showTab(tab) {
    document.getElementById('tab-content-tests').style.display = tab === 'tests' ? '' : 'none';
    document.getElementById('tab-content-users').style.display = tab === 'users' ? '' : 'none';

    // Стилизация кнопок
    ['tab-tests','tab-users'].forEach(id => {
      const btn = document.getElementById(id);
      if((tab === 'tests' && id === 'tab-tests') || (tab === 'users' && id === 'tab-users')) {
        btn.classList.add('bg-blue-500', 'text-white');
        btn.classList.remove('bg-blue-100', 'text-blue-800', 'bg-gray-100', 'text-gray-800');
      } else if(id === 'tab-tests') {
        btn.classList.remove('bg-blue-500','text-white');
        btn.classList.add('bg-blue-100','text-blue-800');
      } else {
        btn.classList.remove('bg-blue-500','text-white');
        btn.classList.add('bg-gray-100','text-gray-800');
      }
    });
  }
  showTab('tests'); // Показываем "Тесты" по умолчанию

  // Реализуем поиск по пользователям
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('user-search');
    const table = document.getElementById('users-tbody');
    if (!searchInput) return;
    searchInput.addEventListener('input', function() {
      const val = this.value.toLowerCase();
      let n = 1;
      table.querySelectorAll('tr').forEach(row => {
        const cells = Array.from(row.children).slice(1); // skip №
        const text = cells.map(c => c.textContent.toLowerCase()).join(' ');
        if (!val || text.includes(val)) {
          row.style.display = '';
          row.children[0].textContent = n++; // порядковый номер
        } else {
          row.style.display = 'none';
        }
      });
    });
  });
</script>
{% endblock %}
